name: Ceph daily build and test on openEuler

on:
  schedule:
    - cron: '0 13 * * *'
  issue_comment:
    types: [created]

jobs:
  build-and-test:
    name: Build and test ceph from source
    if: ${{ contains(github.event.comment.body, 'recheck') || github.event_name == 'schedule' }}
    runs-on: arm64-32u-64g
    steps:
      - name: Echo environment information
        run: |
          /opt/code/action/get_env_info.sh
      - name: Build ceph from source
        run: |
          export LD_LIBRARY_PATH=$LD_LIBRARY:/usr/local/lib64:/usr/local/lib/
          pushd /opt/code/ceph
          git pull
          rm -rf build
          ./do_cmake.sh -DWITH_MGR_DASHBOARD_FRONTEND:BOOL=OFF
          pushd build
          ninja -j32
          popd
          popd
      - name: Run unit test
        run: |
          pushd /opt/code/ceph/build
          ninja check -j32
          popd
